<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <record id="sale_order_form_mr_store_inherit" model="ir.ui.view">
        <field name="name">sale.order.form</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="mr_store_installation_page.sale_order_form_mr_store"/>
        <field name="arch" type="xml">
            <xpath expr="//sheet/div" position="before">
                <field name="is_planned" invisible="1"/>
                <widget name="web_ribbon" title="Planned" bg_color="bg-success" invisible="not is_planned"/>
            </xpath>
            <xpath expr="//page[@name='installation_mrstore']/group" position="inside">
                <group string="Planing Estimate">
                    <field name="P" readonly="False"/>
                    <field name="H" readonly="False"/>
                    <field name="AP" readonly="False"/>
                    <field name="AH" readonly="False"/>
                    <field name="L" readonly="False"/>
                </group>
            </xpath>
            <xpath expr="//form[1]/header[1]/field[@name='state']" position="before">
                <field name="is_planned" invisible="1"/>
                <field name="state" invisible="1"/>
                <button string="Planify" name="action_planify" title="Planify Trello Card" type="object" class="btn-secondary" invisible="is_planned or state != 'sale'"/>
            </xpath>
            <xpath expr="//form[1]/header[1]/button[@name='action_cancel']" position="attributes">
                <attribute name="invisible" position="add" separator=" ">state not in ['draft', 'sent', 'sale'] and not is_planned or not id or locked or not is_planned and state not in ['draft', 'sent', 'sale', 'cancel']</attribute>
            </xpath>
            <xpath expr="//form[1]/header[1]/button[@id='send_by_email']" position="attributes">
                <attribute name="invisible" position="add" separator=" ">state not in ('sent', 'sale')</attribute>
            </xpath>
            <xpath expr="//form[1]/header[1]/button[@id='create_invoice']" position="attributes"> 
                <attribute name="invisible" position="add" separator=" ">invoice_status != 'to invoice'</attribute>
            </xpath>
        </field>
    </record>
</odoo>
